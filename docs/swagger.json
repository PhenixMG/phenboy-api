{"openapi":"3.0.0","info":{"title":"Phenboy API","version":"1.0.0","description":"API du projet Phenboy pour la gestion de serveurs Discord"},"servers":[{"url":"http://localhost:3000","description":"Serveur de développement"}],"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}}},"security":[{"bearerAuth":[]}],"paths":{"/admin/servers/{id}/channels":{"get":{"summary":"Récupère la configuration des salons personnalisés d'un serveur","tags":["Admin - Channels"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Objet contenant les types de salons et leurs channelId","content":{"application/json":{"schema":{"type":"object","example":{"log":"123456","welcome":"7891011","goodbye":"11121314"}}}}},"403":{"description":"L'utilisateur n'est pas propriétaire du serveur"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Ajoute ou met à jour la configuration d'un type de salon","tags":["Admin - Channels"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"type":{"type":"string","enum":["log","welcome","goodbye","announcement"]},"channelId":{"type":"string","nullable":true}}}}}},"responses":{"200":{"description":"Config mise à jour avec succès"},"201":{"description":"Nouvelle config créée avec succès"},"400":{"description":"Type invalide"},"403":{"description":"L'utilisateur n'est pas propriétaire du serveur"},"500":{"description":"Erreur interne"}}}},"/auth/token/access":{"post":{"summary":"Génère un token d'accès pour un utilisateur","tags":["Auth - Tokens"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"integer"},"role":{"type":"string","enum":["user","mods","admin"]}}}}}},"responses":{"200":{"description":"Access token généré","content":{"application/json":{"schema":{"type":"string"}}}}}}},"/auth/token/refresh":{"post":{"summary":"Génère un token de rafraîchissement JWT","tags":["Auth - Tokens"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"integer"},"tokenId":{"type":"string"}}}}}},"responses":{"200":{"description":"Refresh token généré","content":{"application/json":{"schema":{"type":"string"}}}}}}},"/auth/discord/callback":{"get":{"summary":"Callback OAuth2 pour connexion via Discord","tags":["Auth"],"parameters":[{"in":"query","name":"code","required":true,"schema":{"type":"string"}}],"responses":{"302":{"description":"Redirection vers le front avec session initiée"},"400":{"description":"Code manquant ou erreur OAuth"}}}},"/auth/refresh-token":{"post":{"summary":"Rafraîchit un accessToken à partir d'un refreshToken valide","tags":["Auth"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"refreshToken":{"type":"string"}}}}}},"responses":{"200":{"description":"Nouveau accessToken retourné","content":{"application/json":{"schema":{"type":"object","properties":{"accessToken":{"type":"string"}}}}}},"401":{"description":"Token invalide ou expiré"}}}},"/auth/logout":{"post":{"summary":"Déconnecte l'utilisateur actuel (révoque le refreshToken utilisé)","tags":["Auth"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"refreshToken":{"type":"string"}}}}}},"responses":{"200":{"description":"Déconnexion réussie"},"400":{"description":"Token manquant"},"401":{"description":"Token invalide ou expiré"}}}},"/auth/logout-all":{"post":{"summary":"Déconnecte l'utilisateur de tous les appareils","tags":["Auth"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"integer"}}}}}},"responses":{"200":{"description":"Sessions révoquées"},"400":{"description":"Paramètre manquant"}}}},"/auth/me":{"get":{"summary":"Récupère l'utilisateur connecté via le cookie refreshToken","tags":["Auth"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Retourne les infos de l'utilisateur + un nouveau accessToken","content":{"application/json":{"schema":{"type":"object","properties":{"accessToken":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"username":{"type":"string"},"avatar":{"type":"string"}}}}}}}},"401":{"description":"Token invalide ou expiré"}}}},"/division/admin/servers/{id}/division/channels":{"get":{"summary":"Récupère les salons configurés pour les activités The Division 2","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Objet des channels TD2 configurés"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Met à jour ou supprime un salon TD2 pour un type donné","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"type":{"type":"string","enum":["activities","raids","incursions"]},"channelId":{"type":"string","nullable":true}}}}}},"responses":{"200":{"description":"Config mise à jour ou supprimée"},"201":{"description":"Nouvelle config créée"},"400":{"description":"Type invalide"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}}},"/division/admin/servers/{id}/division/blacklist":{"get":{"summary":"Récupère la liste noire The Division 2 pour un serveur","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"responses":{"200":{"description":"Liste des utilisateurs blacklistés"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Ajoute un utilisateur à la blacklist TD2","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"string"},"modId":{"type":"string"},"reason":{"type":"string"}}}}}},"responses":{"201":{"description":"Utilisateur ajouté à la blacklist"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}}},"/division/admin/servers/{id}/division/blacklist/{userId}":{"delete":{"summary":"Retire un utilisateur de la blacklist TD2","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}},{"name":"userId","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Utilisateur retiré de la blacklist"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}}},"/division/admin/servers/{id}/division/activities":{"get":{"summary":"Récupère la liste des activités TD2 planifiées pour un serveur","tags":["Admin - The Division 2"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"responses":{"200":{"description":"Liste des activités"},"403":{"description":"Accès refusé ou module désactivé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/levels":{"get":{"summary":"Récupère tous les niveaux des utilisateurs pour un serveur","tags":["Admin - Levels"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"responses":{"200":{"description":"Liste triée des utilisateurs par XP"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Met à jour ou crée le niveau d'un utilisateur pour un serveur","tags":["Admin - Levels"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"string"},"level":{"type":"integer"},"xp":{"type":"integer"}}}}}},"responses":{"200":{"description":"Niveau mis à jour"},"201":{"description":"Niveau créé"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/levels/{userId}":{"delete":{"summary":"Réinitialise le niveau d'un utilisateur pour un serveur","tags":["Admin - Levels"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}},{"name":"userId","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Niveau supprimé ou message informatif"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/levels/top":{"get":{"summary":"Récupère le top 10 des utilisateurs par XP pour un serveur donné","tags":["Admin - Levels"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Liste des 10 meilleurs utilisateurs"},"403":{"description":"L'utilisateur n'est pas propriétaire du serveur"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/modlogs":{"get":{"summary":"Récupère l'historique de toutes les actions de modération d'un serveur","tags":["Admin - Moderation"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Liste des logs de modération"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Ajoute un log de modération à un serveur","tags":["Admin - Moderation"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"userId":{"type":"string"},"modId":{"type":"string"},"action":{"type":"string","enum":["mute","warn","ban","kick"]},"reason":{"type":"string"},"timestamp":{"type":"string","format":"date-time"}}}}}},"responses":{"201":{"description":"Log créé"},"400":{"description":"Action invalide"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/modlogs/grouped":{"get":{"summary":"Récupère les logs de modération groupés par utilisateur","tags":["Admin - Moderation"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Logs groupés par utilisateur"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/posts":{"get":{"summary":"Récupère la liste de tous les posts","tags":["Public - Posts"],"responses":{"200":{"description":"Liste de posts","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer"},"title":{"type":"string"},"content":{"type":"string"},"createdAt":{"type":"string"},"updatedAt":{"type":"string"}}}}}}}}}},"/admin/servers":{"get":{"summary":"Liste tous les serveurs créés par l'utilisateur connecté","tags":["Admin - Serveurs"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Liste des serveurs","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"discordId":{"type":"string"},"icon":{"type":"string"},"createdAt":{"type":"string"},"updatedAt":{"type":"string"}}}}}}},"500":{"description":"Erreur interne"}}},"post":{"summary":"Ajoute un serveur à la liste de l'utilisateur","tags":["Admin - Serveurs"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"discordId":{"type":"string"},"icon":{"type":"string"}}}}}},"responses":{"200":{"description":"Serveur déjà existant retourné"},"201":{"description":"Serveur créé avec succès"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/modules/td2":{"patch":{"summary":"Active ou désactive le module The Division 2","tags":["Admin - Serveurs"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"enabled":{"type":"boolean"}}}}}},"responses":{"200":{"description":"État du module mis à jour"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/stats/members":{"get":{"summary":"Récupère les statistiques historiques de membres d'un serveur","tags":["Admin - Stats"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Liste des snapshots journaliers de membres"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}},"post":{"summary":"Ajoute ou met à jour un snapshot de nombre de membres pour aujourd'hui","tags":["Admin - Stats"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"integer"}}}}}},"responses":{"200":{"description":"Snapshot mis à jour"},"201":{"description":"Nouveau snapshot ajouté"},"403":{"description":"Accès refusé"},"500":{"description":"Erreur interne"}}}},"/admin/servers/{id}/stats/members/latest":{"get":{"summary":"Récupère le dernier snapshot de nombre de membres pour un serveur","tags":["Admin - Stats"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"integer"},"description":"ID du serveur"}],"responses":{"200":{"description":"Dernier snapshot de membres"},"403":{"description":"Accès refusé"},"404":{"description":"Aucun snapshot trouvé"},"500":{"description":"Erreur interne"}}}},"/users":{"get":{"summary":"Récupère la liste de tous les utilisateurs","tags":["Public - Users"],"responses":{"200":{"description":"Liste des utilisateurs","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer"},"username":{"type":"string"},"role":{"type":"string"}}}}}}}}}},"/users/{id}":{"get":{"summary":"Récupère un utilisateur par son ID","tags":["Public - Users"],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer"}}],"responses":{"200":{"description":"Utilisateur trouvé"},"404":{"description":"Utilisateur non trouvé"}}}}},"tags":[]}